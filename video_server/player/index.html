<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <style>
        * {
            margin: 0;
            padding: 0;
        }

        html,
        body {
            margin: 0;
            height: 100%;
            padding: 0;
            overflow: hidden;
            background-color: black;
        }

        #iframe-target {
            width: 100vw;
            height: 100vh;
            border: 0;
            display: none;
        }

        #iframe-target.show {
            display: block;
        }

        #img-poster {
            object-fit: cover;
            width: 100vw;
            height: 100vh;
            position: fixed;
        }

        #img-poster.hide {
            display: none;
            visibility: hidden;
            pointer-events: none;
        }

    </style>
</head>

<body>
    <iframe id="iframe-target" allowfullscreen></iframe>
    <img id="img-poster" class="hide">
</body>

<!-- This is the self contained file for player + mp4 in same folder -->

<script src="index.js"></script>
<script>
    // Note, fetchPlayerIframeUrl will search url search params for "&p=N", for N = 0,1,2,3
    // If found, it will use that param to determine which player to use.

    const searchParams = new URLSearchParams(window.location.search)
    console.log(window.location.search)
    const urljson = searchParams.get('d')
    const autoplay = searchParams.get('autoplay') === 'true'

    const $iframeTarget = document.getElementById('iframe-target')
    const $imgPoster = document.getElementById('img-poster')

    fetch(urljson)
        .then(response => response.json())
        .then(data => {
            console.log(data)
            const poster = data.poster
            $imgPoster.src = poster
        })

    let loaded = false
    function loadPlayer() {
        if (loaded) {
            return
        }
        loaded = true
        fetchPlayerIframeUrl((iframeUrl, clientType) => {
            // Get the current url path to this file
            const src = "/player/" + clientType + "/index.html" + window.location.search
            console.log("iframe: " + src);
            // Pass the url parameters to the player
            $iframeTarget.src = src
            $imgPoster.classList.add("hide");
            $iframeTarget.classList.add("show");
        })
    }
    if (autoplay) {
        loadPlayer()
    } else {
        document.addEventListener("click", loadPlayer)
        document.addEventListener("touchstart", loadPlayer)
    }

</script>

</html>
